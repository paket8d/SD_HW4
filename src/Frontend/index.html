<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Microservices Shop</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        input { padding: 5px; margin-right: 5px; }
        button { padding: 5px 10px; cursor: pointer; }
        #log { white-space: pre-wrap; background: #f4f4f4; padding: 10px; border: 1px solid #ccc; max-height: 300px; overflow-y: auto; }
        h3 { margin-top: 0; }
        .row { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }
    </style>
</head>
<body>
<h1>üõí –ú–∞–≥–∞–∑–∏–Ω –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤</h1>

<div class="card">
    <h3>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
    <div class="row">
        <input id="userId" placeholder="User ID (guid)" value="user-1" style="width: 200px;" />
        <button onclick="createAccount()">‚ûï –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        <button onclick="getBalance()">üí∞ –£–∑–Ω–∞—Ç—å –±–∞–ª–∞–Ω—Å</button>
    </div>
</div>

<div class="card">
    <h3>üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
    <div class="row">
        <input id="amount" type="number" placeholder="–°—É–º–º–∞" value="100" />
        <button onclick="topUp()">üì• –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
    </div>
</div>

<div class="card">
    <h3>üì¶ –ó–∞–∫–∞–∑—ã</h3>
    <div class="row">
        <input id="orderAmount" type="number" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å" value="50" />
        <button onclick="createOrder()">üõí –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
        <button onclick="getOrders()">üìã –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</button>
    </div>
</div>

<h3>üìú –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π:</h3>
<div id="log"></div>

<script>
    const GATEWAY_URL = 'http://localhost:8080';
    const userIdInput = document.getElementById('userId');
    const logDiv = document.getElementById('log');

    function log(msg, data = null) {
        const time = new Date().toLocaleTimeString();
        let text = `[${time}] ${msg}`;
        if (data) text += '\n' + JSON.stringify(data, null, 2);
        logDiv.textContent = text + '\n' + '-'.repeat(40) + '\n' + logDiv.textContent;
    }

    async function createAccount() {
        try {
            const res = await fetch(`${GATEWAY_URL}/accounts`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: userIdInput.value })
            });
            const data = await res.json(); // –∏–ª–∏ res.text() –µ—Å–ª–∏ 201 –±–µ–∑ —Ç–µ–ª–∞
            log(`–°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞: ${res.status}`, data);
        } catch (e) { log(`–û—à–∏–±–∫–∞: ${e}`); }
    }

    async function getBalance() {
        try {
            // GET /accounts?userId=...
            const res = await fetch(`${GATEWAY_URL}/accounts?userId=${userIdInput.value}`);
            if (res.ok) {
                const data = await res.json();
                log(`–ë–∞–ª–∞–Ω—Å –ø–æ–ª—É—á–µ–Ω: ${res.status}`, data);
            } else {
                log(`–ë–∞–ª–∞–Ω—Å –Ω–µ –Ω–∞–π–¥–µ–Ω: ${res.status}`);
            }
        } catch (e) { log(`–û—à–∏–±–∫–∞: ${e}`); }
    }

    async function topUp() {
        try {
            const res = await fetch(`${GATEWAY_URL}/accounts/top-up`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: userIdInput.value, amount: parseFloat(document.getElementById('amount').value) })
            });
            const data = await res.json();
            log(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: ${res.status}`, data);
        } catch (e) { log(`–û—à–∏–±–∫–∞: ${e}`); }
    }

    async function createOrder() {
        try {
            const res = await fetch(`${GATEWAY_URL}/orders`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: userIdInput.value, amount: parseFloat(document.getElementById('orderAmount').value) })
            });
            const data = await res.json();
            log(`–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω: ${res.status}`, data);
        } catch (e) { log(`–û—à–∏–±–∫–∞: ${e}`); }
    }

    async function getOrders() {
        try {
            // GET /orders?userId=...
            const res = await fetch(`${GATEWAY_URL}/orders?userId=${userIdInput.value}`);
            if (res.ok) {
                const data = await res.json();
                log(`–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤: ${res.status}`, data);
            } else {
                log(`–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã: ${res.status}`);
            }
        } catch (e) { log(`–û—à–∏–±–∫–∞: ${e}`); }
    }
</script>
</body>
</html>
